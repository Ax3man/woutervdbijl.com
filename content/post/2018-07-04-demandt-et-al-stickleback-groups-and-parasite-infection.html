---
title: Demandt et al. - Stickleback groups and parasite infection
author: ~
date: '2018-07-04'
slug: demandt-et-al-stickleback-groups-and-parasite-infection
categories: []
tags: []
header:
  caption: ''
  image: ''
---



<p><a href="http://rspb.royalsocietypublishing.org/content/285/1881/20180956" class="uri">http://rspb.royalsocietypublishing.org/content/285/1881/20180956</a></p>
<pre class="r"><code>library(tidyverse)
library(lmerTest)
library(emmeans)</code></pre>
<pre class="r"><code>url &lt;- &#39;https://datadryad.org/bitstream/handle/10255/dryad.178683/Demandt_et_al_data.xlsx?sequence=1&#39;
httr::GET(url, httr::write_disk(tf &lt;- tempfile(fileext = &quot;.xlsx&quot;)))</code></pre>
<pre class="r"><code>d &lt;- readxl::read_excel(tf)
unlink(tf)</code></pre>
<pre class="r"><code>d2 &lt;- d %&gt;% 
  transmute(
    group = factor(GroupID),
    fish = factor(FishID),
    treatment = factor(TreatmentgroupMS, levels = c(&#39;6u/0i&#39;, &#39;4u/2i&#39;, &#39;2u/4i&#39;, &#39;0u/6i&#39;),
                       labels = c(&#39;6u&#39;, &#39;4u/2i&#39;, &#39;2u/4i&#39;, &#39;6i&#39;)),
    infected = factor(Infected, c(&#39;no&#39;, &#39;Yes&#39;), c(&#39;uninf&#39;, &#39;inf&#39;)),
    time_dangerous = `Time spend in dangerous zone (sec)`,
    period = factor(`BeforeOrAfter bird strike`, c(&#39;Before&#39;, &#39;After&#39;), c(&#39;before&#39;, &#39;after&#39;)),
    escape_zone = factor(`Escape zone`, c(&#39;Safe zone&#39;, &#39;Dangerous zone&#39;), c(&#39;safe&#39;, &#39;dangerous&#39;))
  )

d2</code></pre>
<pre><code>## # A tibble: 336 x 7
##    group fish  treatment infected time_dangerous period escape_zone
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;             &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;      
##  1 3     15    6u        uninf               534 before dangerous  
##  2 3     15    6u        uninf               457 after  dangerous  
##  3 7     37    6u        uninf               371 before dangerous  
##  4 7     37    6u        uninf                99 after  dangerous  
##  5 7     42    6u        uninf               335 before dangerous  
##  6 7     42    6u        uninf                66 after  dangerous  
##  7 1     1     6u        uninf               576 before safe       
##  8 1     1     6u        uninf               118 after  safe       
##  9 1     2     6u        uninf               580 before safe       
## 10 1     2     6u        uninf               172 after  safe       
## # ... with 326 more rows</code></pre>
<pre class="r"><code>d3 &lt;- filter(d2, period == &#39;after&#39;)</code></pre>
<div id="analysis-1-immediate-escape" class="section level3">
<h3>Analysis 1: immediate escape</h3>
<pre class="r"><code>ggplot(d3, aes(infected, escape_zone, fill = infected, group = infected)) +
  geom_violin(scale = &#39;count&#39;)  +
  geom_jitter(height = 0, width = 0.2, alpha = 0.3) +
  facet_grid(~treatment) +
  scale_y_discrete(expand = c(0.1, 0)) +
  scale_fill_manual(values = c(&#39;white&#39;, &#39;grey50&#39;)) +
  labs(x = &#39;infection status&#39;, y = &#39;escape zone&#39;, fill = NULL) +
  theme(legend.position = &#39;bottom&#39;)</code></pre>
<p><img src="/post/2018-07-04-demandt-et-al-stickleback-groups-and-parasite-infection_files/figure-html/recreate_fig2-1.png" width="672" /></p>
<pre class="r"><code>ggplot(d3, aes(infected, as.numeric(escape_zone) - 1, group = infected)) +
  stat_summary(fun.data = &#39;mean_cl_boot&#39;, size = 1.5, fatten = 2.5) +
  facet_grid(~treatment, scales = &#39;free_x&#39;, space = &#39;free_x&#39;) +
  ylim(0, 1) +
  labs(x = &#39;infection status&#39;, y = &#39;fraction with dangerous escape&#39;)</code></pre>
<p><img src="/post/2018-07-04-demandt-et-al-stickleback-groups-and-parasite-infection_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>ggplot(d3, aes(treatment, as.numeric(escape_zone) - 1, color = infected)) +
  stat_summary(fun.data = &#39;mean_cl_boot&#39;, size = 1.5, fatten = 2.5, 
               position =  position_dodge(width = 0.3)) +
  scale_color_manual(values = c(&#39;black&#39;, &#39;grey50&#39;)) +
  ylim(0, 1) +
  labs(x = &#39;group composition&#39;, y = &#39;fraction that lacked escape&#39;, color = &#39;infection status&#39;)</code></pre>
<p><img src="/post/2018-07-04-demandt-et-al-stickleback-groups-and-parasite-infection_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>fm1 &lt;- glmer(escape_zone ~ treatment * infected + (1 | group), d3, &#39;binomial&#39;)</code></pre>
<pre><code>## fixed-effect model matrix is rank deficient so dropping 2 columns / coefficients</code></pre>
<pre class="r"><code>fm2 &lt;- glmer(escape_zone ~ treatment + infected + (1 | group), d3, &#39;binomial&#39;)
AIC(fm1, fm2)</code></pre>
<pre><code>##     df      AIC
## fm1  7 175.3231
## fm2  6 178.7194</code></pre>
<pre class="r"><code>(pairwise &lt;- emmeans(fm1, ~treatment | infected, contr = &#39;pairwise&#39;)$contrast)</code></pre>
<pre><code>## infected = uninf:
##  contrast        estimate       SE  df z.ratio p.value
##  6u - 4u/2i    -0.1797502 1.382841 Inf  -0.130  0.9992
##  6u - 2u/4i    -3.8899251 1.382848 Inf  -2.813  0.0253
##  6u - 6i           nonEst       NA  NA      NA      NA
##  4u/2i - 2u/4i -3.7101750 1.497699 Inf  -2.477  0.0635
##  4u/2i - 6i        nonEst       NA  NA      NA      NA
##  2u/4i - 6i        nonEst       NA  NA      NA      NA
## 
## infected = inf:
##  contrast        estimate       SE  df z.ratio p.value
##  6u - 4u/2i        nonEst       NA  NA      NA      NA
##  6u - 2u/4i        nonEst       NA  NA      NA      NA
##  6u - 6i           nonEst       NA  NA      NA      NA
##  4u/2i - 2u/4i -0.6308713 1.181557 Inf  -0.534  0.9508
##  4u/2i - 6i    -0.2129252 1.132152 Inf  -0.188  0.9976
##  2u/4i - 6i     0.4179462 1.020598 Inf   0.410  0.9768
## 
## Results are given on the log odds ratio (not the response) scale. 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
</div>
<div id="analysis-2-zone-use-after-simulated-attack" class="section level3">
<h3>Analysis 2: zone use after simulated attack</h3>
<pre class="r"><code>ggplot(d2, aes(treatment, time_dangerous, fill = infected)) +
  geom_boxplot(position = position_dodge(0.75, preserve = &#39;single&#39;))  +
  geom_point(alpha = 0.3, position = position_dodge(0.75)) +
  geom_point(shape = &#39;X&#39;, stat = &#39;summary&#39;, fun.y = mean, position = position_dodge(0.75),
             size = 3) +
  facet_grid(~period) +
  scale_fill_manual(values = c(&#39;white&#39;, &#39;grey50&#39;)) +
  labs(x = &#39;treatment&#39;, y = &#39;time spent in dangerous zone&#39;, fill = NULL) +
  theme(legend.position = &#39;bottom&#39;)</code></pre>
<p><img src="/post/2018-07-04-demandt-et-al-stickleback-groups-and-parasite-infection_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>ggplot(d2, aes(treatment, time_dangerous, fill = period)) +
  geom_violin(alpha = 0.3, col = NA) +
  stat_summary(fun.data = &#39;mean_cl_boot&#39;, position = position_dodge(0.9)) +
  facet_grid(~infected, scales = &#39;free&#39;) +
  #scale_fill_manual(values = c(&#39;white&#39;, &#39;grey50&#39;)) +
  labs(x = &#39;infection status&#39;, y = &#39;escape zone&#39;, fill = NULL) +
  theme(legend.position = &#39;bottom&#39;)</code></pre>
<p><img src="/post/2018-07-04-demandt-et-al-stickleback-groups-and-parasite-infection_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>fm3 &lt;- lmer(time_dangerous ~ treatment * period * infected + (period|group) + (1|fish), 
            d2, REML = FALSE)</code></pre>
<pre><code>## fixed-effect model matrix is rank deficient so dropping 4 columns / coefficients</code></pre>
<pre class="r"><code>fm4 &lt;- lmer(time_dangerous ~ (treatment + period + infected)^2 + (period|group) + (1|fish), 
            d2, REML = FALSE)</code></pre>
<pre><code>## fixed-effect model matrix is rank deficient so dropping 2 columns / coefficients</code></pre>
<pre class="r"><code>AIC(fm3, fm4) %&gt;% arrange(AIC) %&gt;% mutate(dAIC = AIC - first(AIC))</code></pre>
<pre><code>##   df      AIC     dAIC
## 1 17 4308.198 0.000000
## 2 16 4310.314 2.115266</code></pre>
<pre class="r"><code>anova(fm3)</code></pre>
<pre><code>## Missing cells for: treatment6i:infecteduninf, treatment6u:infectedinf, treatment6i:periodbefore:infecteduninf, treatment6i:periodafter:infecteduninf, treatment6u:periodbefore:infectedinf, treatment6u:periodafter:infectedinf.  
## Interpret type III hypotheses with care.</code></pre>
<pre><code>## Type III Analysis of Variance Table with Satterthwaite&#39;s method
##                           Sum Sq Mean Sq NumDF   DenDF F value    Pr(&gt;F)
## treatment                  45245   15082     3  30.794  1.2762 0.2998852
## period                    206833  206833     1  28.598 17.5016 0.0002480
## infected                   95806   95806     1 138.969  8.1068 0.0050793
## treatment:period          181438   60479     3  31.267  5.1176 0.0053813
## treatment:infected         80156   80156     1 138.969  6.7826 0.0102062
## period:infected           138877  138877     1 136.777 11.7513 0.0008036
## treatment:period:infected  49373   49373     1 136.777  4.1778 0.0428763
##                              
## treatment                    
## period                    ***
## infected                  ** 
## treatment:period          ** 
## treatment:infected        *  
## period:infected           ***
## treatment:period:infected *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>emmeans(fm3, ~treatment*infected | period)</code></pre>
<pre><code>## fixed-effect model matrix is rank deficient so dropping 4 columns / coefficients</code></pre>
<pre><code>## period = before:
##  treatment infected   emmean       SE    df   lower.CL upper.CL
##  6u        uninf    486.5476 50.76318 32.68 383.230176 589.8651
##  4u/2i     uninf    394.0357 52.44086 37.89 287.864842 500.2066
##  2u/4i     uninf    411.5714 57.17930 55.36 296.998456 526.1444
##  6i        uninf      nonEst       NA    NA         NA       NA
##  6u        inf        nonEst       NA    NA         NA       NA
##  4u/2i     inf      412.5000 57.17930 55.36 297.927028 527.0730
##  2u/4i     inf      392.1071 52.44086 37.89 285.936270 498.2780
##  6i        inf      441.3698 50.76200 32.67 338.054225 544.6855
## 
## period = after:
##  treatment infected   emmean       SE    df   lower.CL upper.CL
##  6u        uninf    114.8571 57.61133 32.67  -2.398311 232.1126
##  4u/2i     uninf    128.2500 59.09491 36.70   8.478912 248.0211
##  2u/4i     uninf    421.3571 63.33748 49.89 294.133393 548.5809
##  6i        uninf      nonEst       NA    NA         NA       NA
##  6u        inf        nonEst       NA    NA         NA       NA
##  4u/2i     inf      341.4286 63.33748 49.89 214.204822 468.6523
##  2u/4i     inf      451.1429 59.09491 36.70 331.371769 570.9139
##  6i        inf      393.4097 57.61029 32.67 276.155839 510.6635
## 
## Degrees-of-freedom method: kenward-roger 
## Confidence level used: 0.95</code></pre>
</div>
